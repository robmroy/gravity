!function(t){var i={};function s(e){if(i[e])return i[e].exports;var h=i[e]={i:e,l:!1,exports:{}};return t[e].call(h.exports,h,h.exports,s),h.l=!0,h.exports}s.m=t,s.c=i,s.d=function(t,i,e){s.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,i){if(1&i&&(t=s(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(s.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var h in t)s.d(e,h,function(i){return t[i]}.bind(null,h));return e},s.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.p="",s(s.s=0)}([function(t,i,s){"use strict";s.r(i);const e=function(t,i,s,e,h,a,r){let l=a-h,n=2*Math.ceil(.5*(l/.1-1))+1,o=l/n;t.strokeStyle=r;for(let a=0;a<n;a++)t.beginPath(),a%2==0&&(t.arc(i,s,e,h+a*o,h+(a+1)*o),t.stroke())},h=function(t){const i=t[0],s=t[1];return 0==i?s>0?Math.PI/2:-Math.PI/2:i>0?Math.atan(s/i):Math.PI+Math.atan(s/i)},a=function(t){return Math.sqrt(t[0]**2+t[1]**2)},r=function(t,i){let[s,e]=t,[h,a]=i;return(a-s)*(h-s)<=0||(a-e)*(h-e)<=0||(e-h)*(s-h)<=0||(e-a)*(s-a)<=0},l=()=>{let t=document.getElementById("game-canvas").getBoundingClientRect();return{x:t.x,y:t.y}};var n=class{constructor(t,i=0,s=0,e=[0,1],a=100,r="white"){this.game=t,this.x=i,this.y=s,this.normal=e,this.radius=a,this.color=r,this.draw=this.draw.bind(this),this.move=this.move.bind(this),this.launch=this.launch.bind(this),this.arrowVector=this.arrowVector.bind(this),this.updatePolar=this.updatePolar.bind(this),this.updateArrowTip=this.updateArrowTip.bind(this),this.updateLaunchVelocity=this.updateLaunchVelocity.bind(this),this.launchVx=0,this.launchVy=0,this.normalAngle=h(e),this.setVelocity=this.setVelocity.bind(this),this.arrowTip={x:null,y:null},this.arrowAngle=this.normalAngle,this.arrowLength=60}move(){this.x+=this.vx,this.y+=this.vy}arrowVector(){return[this.arrowTip.x-this.x,this.arrowTip.y-this.y]}updatePolar(){this.arrowLength=a(this.arrowVector()),this.arrowAngle=h(this.arrowVector())}updateArrowTip(){this.arrowTip.x=this.x+this.arrowLength*Math.cos(this.arrowAngle),this.arrowTip.y=this.y+this.arrowLength*Math.sin(this.arrowAngle)}updateLaunchVelocity(){this.launchVx=this.arrowVector()[0]/4,this.launchVy=this.arrowVector()[1]/4}draw(t){e(t,this.x,this.y,this.radius,this.normalAngle-Math.PI/2,this.normalAngle+Math.PI/2,this.color),null!==this.arrowTip.x&&(t.beginPath(),t.strokeStyle="white",t.setLineDash([5,5]),t.moveTo(this.x,this.y),t.lineTo(this.arrowTip.x,this.arrowTip.y),t.stroke(),this.drawArrowBits(t),t.beginPath(),t.fillStyle="purple",t.font="21px Arial",t.fillText(`Initial speed: ${(this.arrowLength/4).toFixed(2)}`,`${.5*(this.x+this.arrowTip.x)}`,`${.5*(this.y+this.arrowTip.y)}`),t.fill())}drawArrowBits(t){let{x:i,y:s,arrowTip:e}=this;const a=h([e.x-i,e.y-s]);t.setLineDash([]),t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(e.x+12*Math.cos(a+3*Math.PI/4),e.y+12*Math.sin(a+3*Math.PI/4)),t.moveTo(e.x,e.y),t.lineTo(e.x+12*Math.cos(a-3*Math.PI/4),e.y+12*Math.sin(a-3*Math.PI/4)),t.stroke()}launch(){return null!==this.arrowTip.x&&(this.game.ball.stopped=!1,this.game.ball.vx=this.launchVx,this.game.ball.vy=this.launchVy,!0)}setVelocity(t){const i={x:t.clientX-l().x,y:t.clientY-l().y},s=i.x-this.x,e=i.y-this.y;s**2+e**2<=this.radius**2&&s*this.normal[0]+e*this.normal[1]>=0?(this.arrowTip.x=i.x,this.arrowTip.y=i.y,this.updateLaunchVelocity(),this.updatePolar()):this.arrowTip.x=null}setVelocityByArrowKeys(t){Math.cos(this.arrowAngle),Math.sin(this.arrowAngle),40===t.keyCode&&(this.arrowLength-=.5),38===t.keyCode&&(this.arrowLength+=.5),37===t.keyCode&&(this.arrowAngle-=.02),39===t.keyCode&&(this.arrowAngle+=.02),this.updateArrowTip(),this.updateLaunchVelocity()}};var o=class{constructor(t,i=0,s=0,e=5,h="white",a=0,r=0){this.game=t,this.x=i,this.y=s,this.radius=e,this.color=h,this.draw=this.draw.bind(this),this.move=this.move.bind(this),this.vx=a,this.vy=r,this.ax=0,this.ay=0,this.stopped=!0}checkRectangle(t){const{x:i,y:s}=this;return i>t[0][0]&&i<t[1][0]&&s>t[0][1]&&s<t[1][1]}move(){this.logging&&(console.log(`ballx is ${this.x}`),console.log(`bally is ${this.y}`)),this.stopped||(this.x+=this.game.ballSpeedMultiplier*this.vx,this.y+=this.game.ballSpeedMultiplier*this.vy,this.vx+=this.ax,this.vy+=this.ay,Math.abs(this.vx)+Math.abs(this.vy)<.4&&Math.abs(this.ax)+Math.abs(this.ay)<.1&&(this.stopped=!0),this.ax=0,this.ay=0,this.game.planets.forEach(t=>{const{dx:i,dy:s,dz2:e,dz:h,normal:a}=t.ballData();if(h<=this.radius+t.radius){let i=this.radius+t.radius-h;this.x+=i*a[0],this.y+=i*a[1],this.ax=0,this.ay=0,t.sticky||Math.abs(this.vx)+Math.abs(this.vy)<1?(this.stopped=!0,this.game.currentPlanet=t,this.game.launchPad=new n(this.game,this.x,this.y,a),this.game.setupLaunchPad()):t.bounce(a)}else this.ax-=1/e*t.mass*i/h*.2,this.ay-=1/e*t.mass*s/h*.2}),this.game.obstacles.forEach(t=>{t.checkForBall()&&t.bounce()}))}draw(t){t.beginPath(),t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI,!0),t.fill()}};var c=class{constructor(t,i=0,s=0,e=10,h="grey",a,r=0,l=0){this.game=t,this.x=i,this.y=s,this.radius=e,this.color=h,this.draw=this.draw.bind(this),this.move=this.move.bind(this),this.vx=r,this.vy=l,this.density=a||1,this.mass=this.density*this.radius**3,this.sticky=!0}move(){this.x+=this.vx,this.y+=this.vy}ballData(){const t=this.game.ball,i=t.x-this.x,s=t.y-this.y,e=i**2+s**2,h=Math.sqrt(e);return{dx:i,dy:s,dz2:e,dz:h,normal:[i/h,s/h]}}draw(t){t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI,!0),t.font=`${Math.floor(.9*this.radius)}px Arial`,t.fill(),t.beginPath(),t.fillStyle="#3e78ad",t.font="14px Arial",t.fillText(`Escape vel. approx. ${(this.radius*this.density**.45*.504).toFixed(2)}`,`${this.x+this.radius+2}`,`${this.y+.5*this.radius}`),t.fill()}};var d=class{constructor(t,i=0,s=0,e=100,h=100,a="orange"){this.game=t,this.x1=i,this.y1=s,this.x2=e,this.y2=h,this.color=a,this.draw=this.draw.bind(this),this.move=this.move.bind(this);let r=Math.sqrt((s-h)**2+(e-i)**2);this.normal=[(s-h)/r,(e-i)/r],this.bounce=this.bounce.bind(this),this.checkForBall=this.checkForBall.bind(this)}bounce(){let t=this.game.ball,i=this.normal,s=t.vx*i[0]+t.vy*i[1],e=t.vx-2*s*i[0],h=t.vy-2*s*i[1];t.vx=e,t.vy=h}checkForBall(){let t=this.game.ball;t.logging=!1;let{x1:i,x2:s,y1:e,y2:h}=this,a=[e-h,s-i],{x:l,y:n,radius:o,vx:c,vy:d}=t;return(a[0]*(l-i)+a[1]*(n-e))*(a[0]*(l+c-i)+a[1]*(n+d-e))<=0&&r([l,l+c],[i,s])&&r([n,n+d],[e,h])}move(){this.x+=this.vx,this.y+=this.vy}draw(t){t.setLineDash([]),t.beginPath(),t.moveTo(this.x1,this.y1),t.lineTo(this.x2,this.y2),t.strokeStyle=this.color,t.stroke()}};var u=class{constructor(t,i,s,e=[0,1],h=100){this.game=t,this.x=i,this.y=s,this.width=h,this.drawFlag=this.drawFlag.bind(this),this.drawHole=this.drawHole.bind(this),this.normal=e,this.drawFlag=this.drawFlag.bind(this),this.drawHole=this.drawHole.bind(this)}move(){this.x+=this.vx,this.y+=this.vy}drawFlag(t){let i=this.x,s=this.y;t.setLineDash([]),t.beginPath(),t.strokeStyle="gold",t.moveTo(i,s),t.lineTo(i,s-50),t.stroke(),t.fillStyle="red",t.moveTo(i,s-50),t.lineTo(i,s-70),t.lineTo(i+25,s-60),t.lineTo(i,s-50),t.fill()}drawHole(t){let{x:i,y:s,width:e}=this;this.game.ball,t.beginPath(),t.strokeStyle="purple",t.moveTo(i-e/2,s),t.lineTo(i+e/2,s),t.stroke(),t.beginPath(),t.fillStyle="black",t.moveTo(i+e/2,s),t.lineTo(i+e/2,s+30),t.lineTo(i-e/2,s+30),t.lineTo(i-e/2,s),t.fill()}checkForWin(){let{x:t,y:i,width:s,normal:e}=this,h=this.game.ball;return(e[0]*(h.x-t)+e[1]*(h.y-i))*(e[0]*(h.x+h.vx-t)+e[1]*(h.y+h.vy-i))<=0&&r([h.x,h.x+h.vx],[t-.5*s*e[1],t+.5*s*e[1]])&&r([h.y,h.y+h.vy],[i-.5*s*e[0],i+.5*s*e[0]])}};var y=class{constructor(t){const i=1/Math.sqrt(2);this.ball=new o(t,100+30*i,40+30*i),this.corners=[[-200,-200],[1200,900]],this.currentPlanet=new c(t,100,40,25,"#27753a",1),this.launchPad=new n(t,this.ball.x,this.ball.y,[i,i]),this.planets=[this.currentPlanet,new c(t,640,490,20,"orange",3)],this.hole=new u(t,670,450,[0,1],100),this.obstacles=[],this.obstacles=[new d(t,350,280,680,420),new d(t,360,150,710,410)]}};var v=class{constructor(t){this.ball=new o(t,300,100),this.currentPlanet=new c(t,300,70,25,"#27753a",.4),this.corners=[[-200,-200],[1200,900]],this.launchPad=new n(t,300,100),this.planets=[this.currentPlanet,new c(t,300,400,35),new c(t,520,250,30,"orange"),new c(t,580,450,30,"orange")],this.hole=new u(t,700,500),this.obstacles=[],this.obstacles=[new d(t,90,0,90,900),new d(t,600,40,850,300)]}};var w=class{constructor(){this.canvas=document.getElementById("game-canvas"),this.canvas.setAttribute("tabindex",0),this.ctx=this.canvas.getContext("2d"),this.levels=[null,y,v],this.currentLevelNumber=0,this.ballSpeedMultiplier=1,this.draw=this.draw.bind(this),this.initiateLevel=this.initiateLevel.bind(this),this.setupLaunchPad=this.setupLaunchPad.bind(this)}initiateLevel(){if(this.currentLevelNumber+=1,this.currentLevelNumber>=this.levels.length)return this.ball.stopped=!0,this.victoryMessage();const t=new this.levels[this.currentLevelNumber](this);this.ball=t.ball,this.currentPlanet=t.currentPlanet,this.launchPad=t.launchPad,this.planets=t.planets,this.hole=t.hole,this.obstacles=t.obstacles,this.corners=t.corners,this.setupLaunchPad(),requestAnimationFrame(this.animate.bind(this))}restartLevel(){this.currentLevelNumber-=1,this.initiateLevel()}victoryMessage(){const t=this.ctx;t.beginPath(),t.fillStyle="white",t.font="30px Arial",t.fillText("You win!",400,400),t.fill()}setupLaunchPad(){let t=t=>this.launchPad.setVelocity(t),i=this;this.canvas.addEventListener("mousemove",t,!1),this.canvas.onkeydown=s=>{i.canvas.removeEventListener("mousemove",t,!1),i.launchPad.setVelocityByArrowKeys(s),console.log(i)},this.canvas.addEventListener("click",i=>{this.launchPad.launch()&&this.canvas.removeEventListener("mousemove",t)})}step(t){this.moveObjects(t)}moveObjects(){this.ball.move(),this.ball.checkRectangle(this.corners)||this.restartLevel()}animate(t){if(this.hole.checkForWin())return this.ball.stopped=!0,this.initiateLevel();const i=t-this.lastTime;this.step(i),this.draw(),this.lastTime=t,requestAnimationFrame(this.animate.bind(this))}draw(){let t=this.ctx;t.width=1200,t.height=600,t.fillStyle="black",t.fillRect(0,0,1e3,600),this.launchPad.draw(t),this.hole.drawFlag(t),this.ball.draw(t),this.obstacles.forEach(i=>i.draw(t)),this.hole.drawHole(t),this.planets.forEach(i=>i.draw(t))}};document.addEventListener("DOMContentLoaded",t=>{(new w).initiateLevel()})}]);
//# sourceMappingURL=main.js.map